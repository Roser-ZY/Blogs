# Git for Teams-Chapter 3: 工作还原

[TOC]

`Git`将工作目录划分为**工作区、暂存区和仓库**。工作区存放可见的文件，我们所做的任何修改都会在工作区体现；暂存区相当于缓冲区，对工作区的修改进行保存，并在下一次`commit`操作时将暂存区的内容提交到仓库；仓库则储存文件以及所有的历史变更记录。

## 3.1 提交前的还原

在进行`commit`操作之前，所有的工作结果还未进入仓库，我们无法根据仓库中的历史变更记录对之前的工作进行修改和恢复，但这并不代表我们必须提交之后才可以进行工作的还原，`Git`提供了工作区和暂存区的还原方法。

### 3.1.1 工作区还原

在工作区进行一系列修改但并未添加到暂存区时，如果发现结果出现问题，我们会希望能够回溯到最近一次提交时的状态，此时可以通过：

```
git checkout -- filename
```

将某个文件恢复到最近一次提交时的状态。当然也可以同时恢复多个文件：

```
git checkout -- filename1 filename2 ...
```

有时我们创建了文件或文件夹，此时无法通过工作区将其还原，因为文件没有被`Git`添加追踪，此时如果还想使用`Git`进行删除，就只能先添加到暂存区然后使用下一小节的方法进行删除还原。

当然，这种情况下，直接删除新建的文件要更方便。

### 3.1.2 暂存区还原

当文件已经被添加到暂存区时，我们可以使用`reset`将暂存区清空，并将工作区还原到最近一次提交时的状态。在阅读完*提交后的工作还原*小节后，你就会发现我们此处的`reset`实际上就是还原到某次提交的特殊情况。

```
git reset HEAD filename
```

此时文件将会被取消暂存，回到工作区，然后使用工作区的还原方法即可。我们还可以将这两个命令合并：

```
git reset --hard HEAD -- filename
```

如果希望撤销**暂存区和工作区**的所有变更，将所有文件恢复到最近一次提交时的状态，可以批量操作：

```
git reset --hard HEAD
```

这里的`HEAD`指向最近一次成功的提交。

## 3.2 提交后的还原

将暂存区的变更提交后，在仓库中会添加新的一条历史记录，此时我们可以根据该历史记录进行工作还原。在讲解还原之前，我们先来看一下提交的修补。

最简单的修补方法就是使用`--amend`参数，这个参数能够对上一次的提交进行修补：

```
git commit --amend
```

### 3.2.1 Reset

`reset`命令在工作还原中使用频率很高，他的作用就是修改`HEAD`的指向（`HEAD`永远指向最近一次的提交），依此将目标的历史提交作为当前分支最新提交，借以完成回溯（重置）。

当我们直接使用`reset`时，`Git`会将仓库的历史记录重置到指定提交的状态，但是工作区内容并不会改变。即**只改变提交历史，不改变实际内容**。此时我们可以对保留下来的工作结果进行新的提交，或者将指定提交之后的所有提交进行合并，相当于是`--amend`的加强版。

有时我们希望直接将工作区重置到某一个历史提交，而**不在乎其之后的提交**是否保留，此时可以添加`--hard`参数。当使用这个参数时，指定的**某一历史提交之后的所有提交都将被直接舍弃**，工作区重置到目标提交的状态，此时除了**改变历史记录**外，所有**在目标提交之后的提交全都被舍弃**。

查看历史提交记录的命令为：

```
git log
git log --oneline
```

在历史记录中找到目标提交记录的`ID`，然后使用：

```
git reset commitID
```

即可将历史记录重置到目标提交。可以理解为一串珠子中，我们按住了`commitID`指向的珠子，而这之后的所有珠子都滑落到工作区，等待我们的进一步操作。如果使用了`--hard`参数，则掉下来的珠子都将被删除。

### 3.2.2 Revert

`revert`可以用于还原某一次或某几次提交，将这个或这些提交进行反转，相当于将指定的提交所做的工作进行个别还原。与`reset`的区别就是`reset`会将指定提交之后的所有提交都进行重置，而`revert`不会修改`HEAD`指针（即不会修改历史记录），而是**通过新的提交**来完成对指定的某个或某些提交进行还原。

### 3.2.3 Rebase

### 3.2.4 Checkout

## 3.3 撤销分支合并

